<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birds Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 600px; }
        .dropdown {
            margin-bottom: 10px;
        }
        #birdSelect {
            width: 100%;
            height: auto; /* Adjust height for better visibility */
        }
    </style>
</head>
<body>
    <h1>Birds Map</h1>
    
    <div class="dropdown">
        <label for="birdSelect">Select Birds:</label>
        <select id="birdSelect" multiple onchange="updateMarkers()">
            <!-- Options will be populated dynamically -->
        </select>
    </div>
    
    <div id="map"></div>
    
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Initialize the map
        var map = L.map('map').setView([-9.19, -75.0152], 12);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        // Store markers for filtering
        var markers = [];

        // Load CSV data and add markers
        fetch('data.csv') // Make sure to replace this with your actual CSV file path
            .then(response => response.text())
            .then(csvText => {
                const rows = csvText.split('\n').slice(1);
                rows.forEach(row => {
                    const cols = row.split(',');
                    const lat = parseFloat(cols[0]);
                    const lon = parseFloat(cols[1]);
                    const species = cols[2].trim();

                    // Create marker and add to map
                    const marker = L.marker([lat, lon]).addTo(map)
                        .bindPopup(species);

                    // Store marker and species for filtering
                    markers.push({ marker: marker, species: species });

                    // Add option to the dropdown if not already present
                    if (!document.getElementById(species)) {
                        const option = document.createElement('option');
                        option.value = species;
                        option.id = species;
                        option.textContent = species;
                        document.getElementById('birdSelect').appendChild(option);
                    }
                });
            })
            .catch(error => console.error('Error loading CSV:', error));

        // Update markers based on selected species
        function updateMarkers() {
            const selectedOptions = Array.from(document.getElementById("birdSelect").selectedOptions);
            const selectedSpecies = selectedOptions.map(option => option.value);

            // Clear all markers from the map
            markers.forEach(item => {
                map.removeLayer(item.marker);
            });

            // Add back only the selected species markers
            if (selectedSpecies.length > 0) {
                markers.forEach(item => {
                    if (selectedSpecies.includes(item.species)) {
                        item.marker.addTo(map);
                    }
                });
            } else {
                // If no selection, add all markers back
                markers.forEach(item => {
                    item.marker.addTo(map);
                });
            }
        }
    </script>
</body>
</html>
